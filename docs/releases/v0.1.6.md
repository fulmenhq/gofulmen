# Release Notes: v0.1.6

**Release Date**: October 29, 2025  
**Release Type**: Infrastructure Improvement + External Installation Fix  
**Status**: ✅ Released

## Overview

Version 0.1.6 completes the Crucible SemVer migration by adopting Crucible v0.2.1's config embedding, eliminating config file duplication and enabling standard Go module installation for external consumers.

## Features

### Crucible v0.2.1 Config Embedding

**Clean Architecture - No More Duplication**:

- **Direct Config Access**: Foundry now accesses config via `crucible.ConfigRegistry.Library().Foundry().*()` type-safe API
- **No Local Embedding**: Removed `//go:embed assets/*.yaml` from foundry package
- **Single Source of Truth**: Config lives in Crucible only, version-aligned automatically
- **No Sync Needed**: Update go.mod to get new config - no manual sync workflow
- **External Installation Fixed**: Standard `go get github.com/fulmenhq/gofulmen` now works

### Crucible Package Enhancements

- **ConfigRegistry Re-export**: Access to Crucible's embedded config registry
- **Config Type Alias**: Type-safe config access with `crucible.Config`
- **GetConfig() Function**: Generic accessor for any config file by path
- **ListConfigs() Function**: Directory listing for config discovery

### Foundry Package Refactoring

- **Removed Local Assets**: No more duplicated `foundry/assets/*.yaml` files
- **Crucible API Integration**: All config loaded via Crucible's embedded API
- **Backward Compatible**: All existing Foundry APIs work identically
- **Updated Documentation**: Comments reflect new clean architecture

### Comprehensive Testing

- **New Test File**: `crucible/config_test.go` with config embedding verification
- **5 Config Files Tested**: Patterns, country-codes, http-statuses, mime-types, similarity-fixtures
- **Size Validation**: Tests verify configs are non-empty and expected size
- **Fail-Fast Design**: Tests will break loudly if Crucible stops embedding config

## Architecture Improvement

### Before (v0.1.5 - Suboptimal)

```
Crucible Repo
├── config/library/foundry/*.yaml (NOT embedded)
│
↓ make sync (goneat ssot sync)
│
gofulmen Repo
├── config/crucible-go/library/foundry/*.yaml (synced copy)
│
↓ make sync-foundry-assets (manual copy)
│
├── foundry/assets/*.yaml (duplicated)
│   └── //go:embed assets/*.yaml (embedded in gofulmen)
```

**Problems**:

- ❌ Config duplicated in 3 places
- ❌ Requires `make sync` before build
- ❌ Risk of stale config
- ❌ Violates SSOT principle

### After (v0.1.6 - Clean)

```
Crucible Repo (v0.2.1)
├── config/library/foundry/*.yaml
│   └── //go:embed config (embedded in Crucible)
│
↓ import "github.com/fulmenhq/crucible"
│
gofulmen Repo
├── foundry/catalog.go
    └── crucible.ConfigRegistry.Library().Foundry().Patterns()
```

**Benefits**:

- ✅ Single source of truth
- ✅ No sync needed
- ✅ No duplication
- ✅ Version aligned automatically

## Migration Guide

### No Migration Required

This is an internal architecture improvement. All existing code continues to work without changes:

```go
import "github.com/fulmenhq/gofulmen/foundry"

// All existing Foundry APIs work identically
catalog := foundry.GetDefaultCatalog()
pattern, _ := catalog.GetPattern("ansi-email")
country, _ := catalog.GetCountry("US")
mimeType, _ := catalog.GetMimeType("json")
```

### New Capability: Direct Config Access

You can now access Crucible config directly if needed:

```go
import "github.com/fulmenhq/gofulmen/crucible"

// Access specific foundry config files
patterns, _ := crucible.ConfigRegistry.Library().Foundry().Patterns()
countryCodes, _ := crucible.ConfigRegistry.Library().Foundry().CountryCodes()
httpStatuses, _ := crucible.ConfigRegistry.Library().Foundry().HTTPStatuses()
mimeTypes, _ := crucible.ConfigRegistry.Library().Foundry().MIMETypes()
similarityFixtures, _ := crucible.ConfigRegistry.Library().Foundry().SimilarityFixtures()

// Generic config access by path
data, _ := crucible.GetConfig("library/foundry/patterns.yaml")

// List config files in a directory
files, _ := crucible.ListConfigs("library/foundry")
// Returns: ["country-codes.yaml", "http-statuses.yaml", "mime-types.yaml",
//           "patterns.yaml", "similarity-fixtures.yaml"]
```

## Impact on Downstream Consumers

### forge-workhorse-groningen

- ✅ **Installation Works**: `go get github.com/fulmenhq/gofulmen@v0.1.6`
- ✅ **All Config Available**: Foundry catalogs work out of the box
- ✅ **No Manual Setup**: No sync or configuration required

### External Consumers

- ✅ **Standard Installation**: `go get github.com/fulmenhq/gofulmen` works
- ✅ **Zero Configuration**: All config accessible immediately
- ✅ **No Dependencies**: No need to clone Crucible repo

## Quality Metrics

- ✅ **All Tests Passing**: 24 test packages, 100% pass rate
- ✅ **Build Success**: `go build ./...` completes without errors
- ✅ **Config Verified**: All 5 foundry configs load successfully (24,553 bytes total)
- ✅ **External Install Tested**: Standard Go module installation verified
- ✅ **Backward Compatible**: Zero breaking changes

## Technical Details

### Changes

**Crucible Dependency**:

- Updated from v0.2.0 to v0.2.1
- Crucible v0.2.1 adds `//go:embed config` directive

**Foundry Package** (`foundry/catalog.go`):

- Removed `//go:embed assets/*.yaml` directive
- Removed `var configFiles embed.FS`
- Updated `loadYAML()` to call Crucible config API
- Updated documentation comments

**Crucible Package** (`crucible/crucible.go`):

- Added `ConfigRegistry` re-export
- Added `Config` type alias
- Added `GetConfig()` function
- Added `ListConfigs()` function

**New Tests** (`crucible/config_test.go`):

- `TestConfigEmbeddingFromCrucible` - Verifies all 5 config files accessible
- `TestConfigGetConfig` - Tests generic config accessor
- `TestConfigListConfigs` - Tests config directory listing

### Version Information

- **Gofulmen Version**: 0.1.6
- **Crucible Version**: v0.2.1 (2025.10.5 internal version)
- **Go Version**: 1.21+
- **Breaking Changes**: None

## Related Documentation

- [Memo: Config Embedding Missing](../../.plans/memos/crucible/2025-10-29-config-embedding-missing.md) - Identified the issue
- [Memo: v0.2.1 Adoption Complete](../../.plans/memos/crucible/2025-10-29-v021-adoption-complete.md) - Implementation summary
- [ADR-0004: Crucible Runtime Dependency](../development/adr/ADR-0004-crucible-runtime-dependency.md) - Architecture decision
- [Crucible ADR-0009](https://github.com/fulmenhq/crucible) - Go Module Root Relocation
- [Crucible ADR-0010](https://github.com/fulmenhq/crucible) - SemVer Adoption

## Summary

Version 0.1.6 completes the Crucible integration work started in v0.1.5, eliminating config duplication and enabling clean, standard Go module installation for all consumers. The architecture is now optimal: single source of truth maintained, no sync needed, version alignment automatic.

**Ready for production use.** ✅
